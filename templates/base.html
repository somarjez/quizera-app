<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Quizera - E-Learning Platform{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    {% block extra_head %}{% endblock %}

    <!-- Add these styles in the <head> section, after Tailwind and before closing </head> -->
    <style>
      .nav-btn {
        padding: 0.625rem;
        border-radius: 9999px;
        transition: all 0.2s;
      }
      .nav-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fb923c;
        transform: scale(1.1);
      }
      .guest-btn {
        padding: 0.625rem 1.25rem;
        border-radius: 9999px;
        background-color: rgba(255, 255, 255, 0.1);
        transition: all 0.2s;
        font-weight: 500;
      }
      .guest-btn:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }
      .signup-btn {
        padding: 0.625rem 1.25rem;
        border-radius: 9999px;
        background: linear-gradient(to right, #f97316, #ea580c);
        color: white;
        font-weight: 600;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transition: all 0.2s;
      }
      .signup-btn:hover {
        background: linear-gradient(to right, #fb923c, #f97316);
        box-shadow: 0 10px 15px -3px rgba(249, 115, 22, 0.25);
        transform: scale(1.05);
      }
    </style>
    <!-- Page background + layered curves (global) -->
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        background: linear-gradient(180deg, #f8fafc 0%, #eef2ff 60%);
        background-attachment: fixed;
        position: relative;
        overflow-x: hidden;
        min-height: 100vh;
      }
      /* removed left radial accent; keep background clean */
      body::before {
        content: "";
        position: absolute;
        inset: 0;
        z-index: -3;
        pointer-events: none;
        background: none;
        opacity: 0;
      }

      :root {
        --accent-a: #5a63a6;
        --accent-b: #e3a56a;
      }
    </style>
    <style>
      .nav-icon {
        padding: 0.5rem;
        border-radius: 0.375rem;
        transition: all 0.2s;
      }
      .nav-icon:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .link-btn {
        padding: 0.25rem 0.75rem;
        border-radius: 0.375rem;
        transition: all 0.2s;
      }
      .link-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .signup-btn-alt {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        background-color: #f97316;
        color: white;
        font-weight: 500;
        transition: all 0.2s;
      }
      .signup-btn-alt:hover {
        background-color: #fb923c;
      }
      /* Collapsible icons group: hidden by default, shown when .open is applied */
      .icons-group {
        opacity: 0;
        transform: translateX(8px);
        pointer-events: none;
        transition: opacity 180ms ease, transform 180ms ease;
        display: flex;
        align-items: center;
        gap: 0.5rem; /* reduced spacing between icons to prevent overlap */
      }
      .icons-group.open {
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
      }
      .icons-group .nav-icon {
        opacity: 0;
        transform: translateX(6px);
        transition: opacity 200ms ease, transform 200ms ease;
      }
      .icons-group.open .nav-icon {
        opacity: 1;
        transform: translateX(0);
      }
      /* When icons open, shift the role badge left so icons don't overlap it */
      .role-shift {
        transform: translateX(-13rem);
        transition: transform 180ms ease;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen text-base md:text-lg pt-16">
    <!-- Navigation -->
    <nav class="bg-[#141c55] text-white fixed w-full top-0 left-0 z-50">
      <div class="container mx-auto px-6">
        <div
          class="flex items-center justify-between"
          style="padding-top: 0.625rem; padding-bottom: 0.625rem"
        >
          <!-- Left: Logo + Tagline -->
          <div class="flex items-center space-x-2">
            <a
              href="{{ url_for('home') }}"
              class="text-4xl font-extrabold text-orange-500 hover:text-orange-400 transition"
            >
              Quizera
            </a>
            <span class="text-xs uppercase text-gray-300 font-bold mt-4">
              E-learning platform
            </span>
          </div>

          <!-- Center: Search -->
          {% if username %}
          <div class="flex-1 max-w-lg mx-6">
            <form
              action="{{ url_for('search_profiles') }}"
              method="GET"
              class="relative"
            >
              <input
                type="text"
                name="q"
                placeholder="Search users, courses..."
                value="{{ request.args.get('q', '') }}"
                class="w-full pl-4 pr-14 py-2 rounded-full bg-gray-200 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-orange-400 leading-relaxed text-base"
                style="line-height: 1.4; min-height: 1.5rem"
              />
              <button
                type="submit"
                aria-label="Search"
                class="absolute right-4 top-1/2 -translate-y-1/2 text-black hover:text-orange-500"
              >
                <i class="fas fa-search"></i>
              </button>
            </form>
          </div>
          {% endif %}

          <!-- Right: Role + Icons -->
          <div class="flex items-center space-x-4">
            {% if username %}
            <!-- Role Badge (slightly larger and rounder for visibility) -->
            <span
              id="roleBadge"
              class="px-4 py-2 text-sm bg-[#2a326b] rounded-lg font-bold ml-2"
            >
              {{ role|title }}
            </span>

            <!-- Icons: collapsible group with toggle (ellipsis) and logout to the right -->
            <div class="flex items-center">
              <!-- Toggle + hidden group (icons unfold to the left) -->
              <div class="relative flex items-center mr-6">
                <!-- Toggle button that reveals the icons -->
                <button
                  id="iconsToggle"
                  aria-label="Reveal icons"
                  class="nav-icon"
                  aria-expanded="false"
                >
                  <i class="fas fa-chevron-left"></i>
                </button>

                <!-- Hidden until opened; positioned to the left of the toggle -->
                <div
                  id="iconsGroup"
                  class="icons-group absolute right-full mr-2"
                  aria-hidden="true"
                >
                  <a
                    href="{{ url_for('home') }}"
                    class="nav-icon"
                    aria-label="Home"
                  >
                    <i class="fas fa-home"></i>
                  </a>
                  <a
                    href="{{ url_for('dashboard') }}"
                    class="nav-icon"
                    aria-label="Dashboard"
                  >
                    <i class="fas fa-th-large"></i>
                  </a>
                  <a
                    href="{{ url_for('notifications') }}"
                    class="nav-icon relative"
                    aria-label="Notifications"
                  >
                    <i class="fas fa-bell"></i>
                    {% if unread_notifications_count and
                    unread_notifications_count > 0 %}
                    <span
                      class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center"
                    >
                      {{ unread_notifications_count if
                      unread_notifications_count < 99 else '99+' }}
                    </span>
                    {% endif %}
                  </a>
                  <a
                    href="{{ url_for('chat') }}"
                    class="nav-icon"
                    aria-label="Chat"
                  >
                    <i class="fas fa-comments"></i>
                  </a>
                  <a
                    href="{{ url_for('profile') }}"
                    class="nav-icon"
                    aria-label="Profile"
                  >
                    <i class="fas fa-user"></i>
                  </a>
                </div>
              </div>

              <!-- Logout remains on the right side; smaller left margin now that icons are in the collapsible group -->
              <a
                href="{{ url_for('logout') }}"
                class="nav-icon text-white-400 hover:text-white-300 ml-2"
                aria-label="Logout"
              >
                <i class="fas fa-sign-out-alt"></i>
              </a>
            </div>
            {% else %}
            <!-- Guest -->
            <div class="flex items-center space-x-6">
              <a href="{{ url_for('home') }}" class="link-btn">Home</a>
              <a href="{{ url_for('login') }}" class="link-btn">Login</a>
              <a href="{{ url_for('signup') }}" class="signup-btn">Sign Up</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>
    <!-- END Navigation -->
    <!-- Layered curved background removed per design request -->

    <!-- Flash Messages (Enhanced Version) -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <script type="text/javascript">
      // Flash messages data (use a single tojson call to avoid template/JS parsing issues)
      var flashMessagesRaw = {{ get_flashed_messages(with_categories=true)|tojson }};
      var flashMessages = (flashMessagesRaw || []).map(function(pair, idx) {
        return {
          message: pair[1],
          category: pair[0],
          delay: idx * 200
        };
      });


      document.addEventListener('DOMContentLoaded', function() {
        // Display flash messages
        if (typeof showMessage === 'function') {
          flashMessages.forEach(function(item) {
            setTimeout(function() {
              showMessage(item.message, item.category);
            }, item.delay);
          });
        } else {
          // Fallback if showMessage isn't loaded yet
          setTimeout(function() {
            flashMessages.forEach(function(item) {
              if (typeof showMessage === 'function') {
                showMessage(item.message, item.category);
              } else {
                console.error('Flash message system not loaded:', item.message);
              }
            });
          }, 100);
        }
      });
    </script>
    {% endif %} {% endwith %}

    <!-- Main Content -->
    <main class="{% block main_class %}{% endblock %}">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12 mt-16">
      <div class="container mx-auto px-4">
        {% block footer %}
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div class="col-span-2">
            <h3 class="text-2xl font-bold mb-4">Quizera</h3>
            <p class="text-gray-300 mb-4">
              Empowering Computer Science students with interactive learning
              experiences and comprehensive educational resources.
            </p>
            <div class="flex space-x-4">
              <a
                href="#"
                class="text-gray-300 hover:text-white transition-colors"
              >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"
                  />
                </svg>
              </a>
              <a
                href="#"
                class="text-gray-300 hover:text-white transition-colors"
              >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"
                  />
                </svg>
              </a>
              <a
                href="#"
                class="text-gray-300 hover:text-white transition-colors"
              >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
                  />
                </svg>
              </a>
            </div>
          </div>

          <div>
            <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="{{ url_for('home') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >Home</a
                >
              </li>
              <li>
                <a
                  href="{{ url_for('signup') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >Sign Up</a
                >
              </li>
              <li>
                <a
                  href="{{ url_for('login') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >Login</a
                >
              </li>
              <li>
                <a
                  href="{{ url_for('about') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >About Us</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="{{ url_for('help_center') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >Help Center</a
                >
              </li>
              <li>
                <a
                  href="{{ url_for('contact') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >Contact Us</a
                >
              </li>
              <li>
                <a
                  href="{{ url_for('privacy') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="{{ url_for('terms') }}"
                  class="text-gray-300 hover:text-white transition-colors"
                  >Terms of Service</a
                >
              </li>
            </ul>
          </div>
        </div>

        <div class="border-t border-gray-700 mt-8 pt-8 text-center">
          <p class="text-gray-300">&copy; 2024 Quizera. All rights reserved.</p>
          <p class="text-gray-400 text-sm mt-2">
            Building the future of Computer Science education
          </p>
        </div>
        {% endblock %}
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
      // Icons group toggle: reveal/hide icons when clicking the ellipsis toggle
      document.addEventListener("DOMContentLoaded", function () {
        const iconsToggle = document.getElementById("iconsToggle");
        const iconsGroup = document.getElementById("iconsGroup");
        const roleBadge = document.getElementById("roleBadge");

        if (!iconsToggle || !iconsGroup) return;

        iconsToggle.addEventListener("click", function (e) {
          e.stopPropagation();
          const opened = iconsGroup.classList.toggle("open");
          iconsGroup.setAttribute("aria-hidden", !opened);
          // toggle badge shift so icons push the badge instead of overlapping
          if (roleBadge) roleBadge.classList.toggle("role-shift", opened);
          // update toggle icon (left chevron when closed, right chevron when opened)
          const toggleIcon = iconsToggle.querySelector("i");
          if (toggleIcon) {
            toggleIcon.classList.toggle("fa-chevron-left", !opened);
            toggleIcon.classList.toggle("fa-chevron-right", opened);
          }
          iconsToggle.setAttribute("aria-expanded", opened ? "true" : "false");
        });

        // Close when clicking outside
        document.addEventListener("click", function (e) {
          if (
            !iconsGroup.contains(e.target) &&
            !iconsToggle.contains(e.target)
          ) {
            if (iconsGroup.classList.contains("open")) {
              iconsGroup.classList.remove("open");
              iconsGroup.setAttribute("aria-hidden", "true");
              if (roleBadge) roleBadge.classList.remove("role-shift");
            }
          }
        });

        // Close on Escape
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && iconsGroup.classList.contains("open")) {
            iconsGroup.classList.remove("open");
            iconsGroup.setAttribute("aria-hidden", "true");
            if (roleBadge) roleBadge.classList.remove("role-shift");
          }
        });
      });
    </script>
    {% block extra_scripts %}{% endblock %}
  </body>
</html>
